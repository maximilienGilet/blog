---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import LinkButton from "@components/LinkButton.astro";
import Hr from "@components/Hr.astro";
import Card from "@components/Card";
import Socials from "@components/Socials.astro";
import getSortedPosts from "@utils/getSortedPosts";
import { SOCIALS } from "@config";
import GitHub from "@components/icons/GitHub.astro";
import ExternalLink from "@components/icons/ExternalLink.astro";
import CodingIcon from "@components/icons/CodingIcon.astro";
import { slugifyStr } from "@utils/slugify";

const posts = await getCollection("blog");
const projects = await getCollection("projets");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);

// Sort projects by date and get the latest 3
const sortedProjects = projects
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const socialCount = SOCIALS.filter(social => social.active).length;

const profilePicture = "/assets/profile.avif";
---

<Layout>
  <Header />
  <div id="hero">
    <div class="lg:max-w-xl">
      <h1 class="mono">Maximilien Gilet</h1>
      <a
        target="_blank"
        href="/rss.xml"
        class="rss-link"
        aria-label="rss feed"
        title="RSS Feed"
      >
        <svg
          width="33"
          height="32"
          viewBox="0 0 33 32"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="rss-icon"
        >
          <path
            d="M29.8052 15.235H28.2852V12.185H26.7552V10.665H25.2352V9.14499H23.7052V7.61499H22.1852V6.09499H20.6652V4.57499H17.6152V3.04499H13.0452V1.52499H3.90515V4.57499H13.0452V6.09499H17.6152V7.61499H20.6652V9.14499H22.1852V10.665H23.7052V12.185H25.2352V15.235H26.7552V19.805H28.2852V28.955H31.3252V19.805H29.8052V15.235Z"
          ></path>
          <path
            d="M3.90515 7.61499V10.665H11.5152V12.185H14.5652V13.715H17.6152V15.235H19.1352V18.285H20.6652V21.335H22.1852V28.955H25.2352V21.335H23.7052V18.285H22.1852V15.235H20.6652V13.715H19.1352V12.185H17.6152V10.665H14.5652V9.14499H11.5152V7.61499H3.90515Z"
          ></path>
          <path
            d="M3.90515 16.765H9.99515V18.285H13.0452V19.805H14.5652V22.855H16.0952V28.955H19.1352V22.855H17.6152V19.805H16.0952V18.285H14.5652V16.765H13.0452V15.235H9.99515V13.715H3.90515V16.765Z"
          ></path>
          <path
            d="M3.90512 24.375H2.37512V28.955H3.90512V30.475H8.47512V28.955H9.99512V24.375H8.47512V22.855H3.90512V24.375Z"
          ></path>
        </svg>
        <span class="sr-only">RSS Feed</span>
      </a>

      <p>
        Développeur fullstack passionné, <strong>je transforme des idées</strong
        > en <strong>applications web performantes</strong> et <strong
          >durables</strong
        >. Spécialisé en React, TypeScript et Next.js, je partage mon expertise,
        mes réflexions techniques et mes retours d'expérience sur le
        développement moderne.
        <br />
        <br />
        Bienvenue dans mon univers où code rime avec innovation !
      </p>
      {
        // only display if at least one social link is enabled
        socialCount > 0 && (
          <div class="social-wrapper">
            <Socials />
          </div>
        )
      }
    </div>
    <div class="hidden lg:block">
      <Image
        src={profilePicture}
        class="shadow-fat rounded-lg border-2 border-skin-line"
        alt="Photo de profil"
        width={300}
        height={300}
      />
    </div>
  </div>

  <main id="main-content">
    <Hr />

    {
      recentPosts.length > 0 && (
        <>
          <section id="recent-posts">
            <h2>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 32 32"
                class="scale-125"
              >
                <g>
                  <path
                    d="m28.96 25.91 0 1.52 1.52 0 0 3.05 1.52 0 0 -6.1 -1.52 0 0 1.53 -1.52 0z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M28.96 21.33h1.52v3.05h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M1.53 30.48h28.95V32H1.53Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M27.43 18.29h1.53v3.04h-1.53Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M3.05 27.43h25.91v1.52H3.05Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="m25.91 18.29 1.52 0 0 -4.57 1.53 0 0 -1.53 -3.05 0 0 6.1z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="m24.39 3.05 0 1.52 3.04 0 0 -3.05 -1.52 0 0 1.53 -1.52 0z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M13.72 15.24h4.57v1.52h-4.57Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="m22.86 1.52 0 1.53 1.53 0 0 -1.53 1.52 0 0 -1.52 -15.24 0 0 1.52 12.19 0z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M27.43 25.91v-3.05h-1.52v-3.05h-1.52v-1.52H7.62v1.52H6.1v3.05H4.58v3.05Zm-3.04 -1.53h-1.53v-1.52h1.53Zm-3.05 -4.57h1.52v1.52h-1.52Zm0 4.57h-1.53v-1.52h1.53Zm-3.05 -4.57h1.52v1.52h-1.52Zm0 4.57h-4.57v-1.52h4.57Zm-3.05 -4.57h1.53v1.52h-1.53Zm-3.04 0h1.52v1.52H12.2Zm0 4.57h-1.53v-1.52h1.53Zm-3.05 -4.57h1.52v1.52H9.15Zm-1.53 3.05h1.53v1.52H7.62Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="m6.1 12.19 -1.52 0 0 -1.52 1.52 0 0 1.52 1.52 0 0 -1.52 4.58 0 0 1.52 -1.53 0 0 1.53 10.67 0 0 -1.53 -1.53 0 0 -1.52 4.58 0 0 1.52 1.52 0 0 -1.52 3.05 0 0 1.52 1.52 0 0 -3.05 -3.05 0 0 -1.52 -1.52 0 0 1.52 -3.05 0 0 -1.52 3.05 0 0 -1.52 -3.05 0 0 -3.05 -1.52 0 0 6.09 -10.67 0 0 -7.62 -1.52 0 0 4.58 -3.05 0 0 1.52 3.05 0 0 1.52 -3.05 0 0 -1.52 -1.52 0 0 1.52 -3.05 0 0 1.53 1.52 0 0 3.05 1.53 0 0 4.57 1.52 0 0 -6.1z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M3.05 18.29h1.53v3.04H3.05Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M1.53 21.33h1.52v3.05H1.53Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="m1.53 27.43 1.52 0 0 -1.52 -1.52 0 0 -1.53 -1.53 0 0 6.1 1.53 0 0 -3.05z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M0 6.1h1.53v3.04H0Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                </g>
              </svg>
              Derniers posts
            </h2>
            <ul>
              {recentPosts.map(
                ({ data, slug }, index) =>
                  index < 4 && (
                    <Card
                      href={`/posts/${slug}/`}
                      frontmatter={data}
                      secHeading={false}
                    />
                  )
              )}
            </ul>
          </section>
          <div class="all-posts-btn-wrapper mono">
            <LinkButton href="/posts/"> Tous les posts &rarr; </LinkButton>
          </div>
          <Hr />
        </>
      )
    }

    <section id="latest-projects">
      <h2>
        <CodingIcon class="scale-125" />
        Projets récents
      </h2>
      <ul class="mt-8 space-y-8">
        {
          sortedProjects.map(project => (
            <li class="hover:shadow-fat-accent group rounded-lg border-2 border-skin-line p-6 transition-all hover:-translate-x-1 hover:-translate-y-1 hover:border-skin-accent">
              <article>
                <a href={`/projets/${project.slug}`} class="block">
                  {project.data.image && (
                    <img
                      src={"/" + project.data.image}
                      alt={project.data.title}
                      class="mb-4 max-h-96 w-full rounded-lg object-cover"
                      transition:name={`project-image-${slugifyStr(project.data.slug)}`}
                    />
                  )}
                  <div class="flex items-start justify-between">
                    <div>
                      <h3
                        class="text-xl font-semibold group-hover:text-skin-accent"
                        transition:name={`project-title-${slugifyStr(project.data.slug)}`}
                      >
                        {project.data.title}
                      </h3>
                      <p
                        class="text-skin-muted mt-2"
                        transition:name={`project-desc-${slugifyStr(project.data.slug)}`}
                      >
                        {project.data.description}
                      </p>
                    </div>
                    <div class="flex items-center gap-3">
                      {project.data.github && (
                        <a
                          href={project.data.github}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="hover:text-skin-accent"
                          title="Voir sur GitHub"
                          transition:name={`project-github-${slugifyStr(project.data.slug)}`}
                        >
                          <GitHub class="h-6 w-6" />
                        </a>
                      )}
                      {project.data.link && (
                        <a
                          href={project.data.link}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="hover:text-skin-accent"
                          title="Voir le projet"
                          transition:name={`project-link-${slugifyStr(project.data.slug)}`}
                        >
                          <ExternalLink class="h-6 w-6" />
                        </a>
                      )}
                    </div>
                  </div>
                </a>
              </article>
            </li>
          ))
        }
      </ul>
      <div class="mt-8 text-center">
        <LinkButton href="/projets/">Voir tous les projets &rarr;</LinkButton>
      </div>
    </section>

    {
      featuredPosts.length > 0 && (
        <>
          <Hr />
          <section id="featured">
            <h2>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 32 32"
                class="scale-125"
              >
                <g>
                  <path
                    d="M30.48 20.57H32v1.52h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="m7.62 22.09 0 -4.57 -1.52 0 0 -13.71 -1.52 0 0 1.52 -3.05 0 0 1.53 1.52 0 0 10.66 1.53 0 0 4.57 1.52 0 0 1.53 1.52 0 0 1.52 13.72 0 0 1.53 1.52 0 0 -3.05 3.05 0 0 6.09 1.52 0 0 -6.09 3.05 0 0 -1.53 -22.86 0z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M27.43 19.05h3.05v1.52h-3.05Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M25.91 3.81h1.52v15.24h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M6.1 29.71h19.81v1.53H6.1Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M21.34 8.38h1.52v3.05h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M19.81 11.43h1.53v1.52h-1.53Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M18.29 6.86h3.05v1.52h-3.05Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M18.29 19.05h3.05v1.52h-3.05Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M18.29 12.95h1.52v1.53h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M16.77 17.52h1.52v1.53h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M16.77 14.48h1.52V16h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M16.77 8.38h1.52V9.9h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M15.24 16h1.53v1.52h-1.53Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M15.24 9.9h1.53v1.53h-1.53Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M13.72 14.48h1.52V16h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M13.72 8.38h1.52V9.9h-1.52Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M12.2 17.52h3.04v1.53H12.2Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M12.2 12.95h1.52v1.53H12.2Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M10.67 6.86h3.05v1.52h-3.05Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M10.67 11.43h1.53v1.52h-1.53Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M9.15 8.38h1.52v3.05H9.15Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="m10.67 3.81 0 1.52 10.67 0 0 -1.52 4.57 0 0 -1.53 -4.57 0 0 -1.52 -10.67 0 0 1.52 -4.57 0 0 1.53 4.57 0z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="m21.34 28.19 0 -1.52 -19.81 0 0 1.52 3.05 0 0 1.52 1.52 0 0 -1.52 15.24 0z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                  <path
                    d="M0 6.86h1.53v19.81H0Z"
                    fill="currentColor"
                    stroke-width="1"
                  />
                </g>
              </svg>
              En vedette
            </h2>
            <ul>
              {featuredPosts.map(({ data, slug }) => (
                <Card
                  href={`/posts/${slug}/`}
                  frontmatter={data}
                  secHeading={false}
                />
              ))}
            </ul>
          </section>
        </>
      )
    }
  </main>

  <Footer />

  <style>
    /* ===== Hero Section ===== */
    #hero {
      @apply mx-auto inline-block max-w-3xl items-center gap-4 px-4 pb-14 pt-8 lg:flex lg:max-w-max lg:justify-center;
    }
    #hero h1 {
      @apply my-4 inline-block text-3xl font-bold sm:my-8 sm:text-5xl;
    }
    #hero .rss-link {
      @apply mb-6;
    }
    #hero .rss-icon {
      @apply mb-2 h-6 w-6 scale-110 fill-skin-accent sm:mb-3 sm:scale-125;
    }
    #hero p {
      @apply my-2;
    }
    .social-wrapper {
      @apply mt-4 flex flex-col sm:flex-row sm:items-center;
    }
    .social-links {
      @apply mb-1 mr-2 whitespace-nowrap sm:mb-0;
    }

    /* ===== Featured & Recent Posts Sections ===== */
    #featured,
    #recent-posts,
    #latest-projects {
      @apply pb-6 pt-12;
    }
    #featured h2,
    #recent-posts h2,
    #latest-projects h2 {
      @apply text-2xl font-semibold tracking-wide;
    }
    .all-posts-btn-wrapper {
      @apply my-8 text-center;
    }
  </style>
</Layout>
